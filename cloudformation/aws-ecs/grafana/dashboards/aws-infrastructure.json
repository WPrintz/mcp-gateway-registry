{
  "id": null,
  "uid": "aws-infra",
  "title": "MCP Gateway - AWS Infrastructure",
  "tags": ["aws", "ecs", "cloudwatch", "infrastructure"],
  "timezone": "browser",
  "refresh": "30s",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "title": "ECS Service CPU Utilization",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/ECS",
          "metricName": "CPUUtilization",
          "statistics": ["Average"],
          "dimensions": {
            "ClusterName": "${cluster_name}",
            "ServiceName": "${service_name}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "steps": [
              {"color": "green", "value": 0},
              {"color": "yellow", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "id": 2,
      "title": "ECS Service Memory Utilization",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/ECS",
          "metricName": "MemoryUtilization",
          "statistics": ["Average"],
          "dimensions": {
            "ClusterName": "${cluster_name}",
            "ServiceName": "${service_name}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "steps": [
              {"color": "green", "value": 0},
              {"color": "yellow", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "id": 3,
      "title": "ALB Request Count",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/ApplicationELB",
          "metricName": "RequestCount",
          "statistics": ["Sum"],
          "dimensions": {
            "LoadBalancer": "${alb_name}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 8, "x": 0, "y": 8},
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "axisLabel": "Requests"
          }
        }
      }
    },
    {
      "id": 4,
      "title": "ALB Target Response Time",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/ApplicationELB",
          "metricName": "TargetResponseTime",
          "statistics": ["Average"],
          "dimensions": {
            "LoadBalancer": "${alb_name}"
          },
          "region": "default",
          "period": "60",
          "label": "Average"
        },
        {
          "refId": "B",
          "namespace": "AWS/ApplicationELB",
          "metricName": "TargetResponseTime",
          "statistics": ["p95"],
          "dimensions": {
            "LoadBalancer": "${alb_name}"
          },
          "region": "default",
          "period": "60",
          "label": "P95"
        }
      ],
      "gridPos": {"h": 8, "w": 8, "x": 8, "y": 8},
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "thresholds": {
            "steps": [
              {"color": "green", "value": 0},
              {"color": "yellow", "value": 1},
              {"color": "red", "value": 3}
            ]
          }
        }
      }
    },
    {
      "id": 5,
      "title": "ALB HTTP Response Codes",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/ApplicationELB",
          "metricName": "HTTPCode_Target_2XX_Count",
          "statistics": ["Sum"],
          "dimensions": {
            "LoadBalancer": "${alb_name}"
          },
          "region": "default",
          "period": "60",
          "label": "2XX"
        },
        {
          "refId": "B",
          "namespace": "AWS/ApplicationELB",
          "metricName": "HTTPCode_Target_4XX_Count",
          "statistics": ["Sum"],
          "dimensions": {
            "LoadBalancer": "${alb_name}"
          },
          "region": "default",
          "period": "60",
          "label": "4XX"
        },
        {
          "refId": "C",
          "namespace": "AWS/ApplicationELB",
          "metricName": "HTTPCode_Target_5XX_Count",
          "statistics": ["Sum"],
          "dimensions": {
            "LoadBalancer": "${alb_name}"
          },
          "region": "default",
          "period": "60",
          "label": "5XX"
        }
      ],
      "gridPos": {"h": 8, "w": 8, "x": 16, "y": 8},
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "2XX"},
            "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]
          },
          {
            "matcher": {"id": "byName", "options": "4XX"},
            "properties": [{"id": "color", "value": {"fixedColor": "orange", "mode": "fixed"}}]
          },
          {
            "matcher": {"id": "byName", "options": "5XX"},
            "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]
          }
        ]
      }
    },
    {
      "id": 6,
      "title": "DocumentDB Connections",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/DocDB",
          "metricName": "DatabaseConnections",
          "statistics": ["Average"],
          "dimensions": {
            "DBClusterIdentifier": "${docdb_cluster}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 8, "x": 0, "y": 16},
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "axisLabel": "Connections"
          }
        }
      }
    },
    {
      "id": 7,
      "title": "DocumentDB CPU Utilization",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/DocDB",
          "metricName": "CPUUtilization",
          "statistics": ["Average"],
          "dimensions": {
            "DBClusterIdentifier": "${docdb_cluster}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 8, "x": 8, "y": 16},
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "thresholds": {
            "steps": [
              {"color": "green", "value": 0},
              {"color": "yellow", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "id": 8,
      "title": "DocumentDB Freeable Memory",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/DocDB",
          "metricName": "FreeableMemory",
          "statistics": ["Average"],
          "dimensions": {
            "DBClusterIdentifier": "${docdb_cluster}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 8, "x": 16, "y": 16},
      "fieldConfig": {
        "defaults": {
          "unit": "bytes"
        }
      }
    },
    {
      "id": 9,
      "title": "Aurora Serverless ACU (Keycloak DB)",
      "type": "timeseries",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/RDS",
          "metricName": "ServerlessDatabaseCapacity",
          "statistics": ["Average"],
          "dimensions": {
            "DBClusterIdentifier": "${keycloak_db_cluster}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "axisLabel": "ACU"
          }
        }
      }
    },
    {
      "id": 10,
      "title": "ECS Running Task Count",
      "type": "stat",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "ECS/ContainerInsights",
          "metricName": "RunningTaskCount",
          "statistics": ["Average"],
          "dimensions": {
            "ClusterName": "${cluster_name}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 4, "w": 6, "x": 12, "y": 24},
      "options": {
        "colorMode": "background",
        "graphMode": "area"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "steps": [
              {"color": "red", "value": 0},
              {"color": "yellow", "value": 1},
              {"color": "green", "value": 3}
            ]
          }
        }
      }
    },
    {
      "id": 11,
      "title": "ALB Healthy Hosts",
      "type": "stat",
      "datasource": "CloudWatch",
      "targets": [
        {
          "refId": "A",
          "namespace": "AWS/ApplicationELB",
          "metricName": "HealthyHostCount",
          "statistics": ["Average"],
          "dimensions": {
            "LoadBalancer": "${alb_name}",
            "TargetGroup": "${target_group}"
          },
          "region": "default",
          "period": "60"
        }
      ],
      "gridPos": {"h": 4, "w": 6, "x": 18, "y": 24},
      "options": {
        "colorMode": "background",
        "graphMode": "area"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "steps": [
              {"color": "red", "value": 0},
              {"color": "yellow", "value": 1},
              {"color": "green", "value": 2}
            ]
          }
        }
      }
    }
  ],
  "templating": {
    "list": [
      {
        "name": "cluster_name",
        "type": "constant",
        "query": "mcp-gateway-ecs-cluster",
        "hide": 2
      },
      {
        "name": "service_name",
        "type": "query",
        "datasource": "CloudWatch",
        "query": {
          "queryType": "dimensionValues",
          "namespace": "AWS/ECS",
          "dimensionKey": "ServiceName",
          "dimensionFilters": {
            "ClusterName": "$cluster_name"
          },
          "region": "default"
        },
        "refresh": 1,
        "includeAll": true,
        "allValue": "*"
      },
      {
        "name": "alb_name",
        "type": "constant",
        "query": "app/mcp-gateway-alb/",
        "hide": 2
      },
      {
        "name": "target_group",
        "type": "constant",
        "query": "targetgroup/mcp-gateway-registry/",
        "hide": 2
      },
      {
        "name": "docdb_cluster",
        "type": "constant",
        "query": "mcp-gateway-registry",
        "hide": 2
      },
      {
        "name": "keycloak_db_cluster",
        "type": "constant",
        "query": "mcp-gateway-keycloak-db",
        "hide": 2
      }
    ]
  },
  "schemaVersion": 39,
  "version": 1
}
